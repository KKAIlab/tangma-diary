# 糖妈日记 v2.1 更新说明 🚀

**发布日期**：2025-12-19
**版本号**：v2.1 (智能辅助版)
**更新地址**：https://kkailab.github.io/tangma-diary/

---

## 🎯 本次更新核心：从"记录工具" → "智能助手"

基于市场调研和用户需求分析，我们添加了三大智能辅助功能，帮助准妈妈们更科学地管理血糖。

---

## 🆕 新增功能

### 1. ⏰ 智能餐后提醒（核心功能）

**解决痛点**：忘记测血糖、错过最佳测量时间

**功能描述**：
- 📱 **浏览器通知提醒**：记录用餐时间后，自动设置提醒
- ⏱️ **餐后1小时提醒**：提示测血糖，目标<140 mg/dL
- ⏱️ **餐后2小时提醒**：提示测血糖，目标<120 mg/dL
- 🌐 **多语言支持**：中文、日语、英语三语提醒
- 🔔 **一键开关**：在"指南"页面随时开启/关闭

**如何使用**：
```
方式1（自动）：
1. 添加记录时填写用餐时间
2. 首次会询问是否开启提醒
3. 允许通知权限
4. 到时间自动提醒

方式2（手动）：
1. 打开应用 → 点击"指南"标签
2. 找到"⏰ 智能提醒"卡片
3. 点击"开启餐后提醒"按钮
4. 允许浏览器通知权限
```

**提醒内容示例**：
- 🩸 血糖测量提醒
- 早餐后1小时了，该测血糖了！
- 目标：<140 mg/dL

**技术特点**：
- ✅ 完全本地运行，不依赖服务器
- ✅ 只为今天和未来的餐次设置提醒
- ✅ 自动跳过已过时间的餐次
- ✅ 支持多个提醒同时设置

---

### 2. 💡 碳水化合物智能参考表

**解决痛点**：不知道食物含多少碳水，无法科学控糖

**功能描述**：
- 📊 **内置100+种食物碳水数据**：主食、蛋白质、蔬菜、水果、坚果等
- 🔄 **实时计算**：输入食物时自动显示碳水估算
- 📋 **详细分解**：显示每种食物的碳水含量
- ⚠️ **智能建议**：超标时自动提示

**覆盖食物类别**：
| 类别 | 示例食物 | 碳水含量（每100g） |
|------|---------|-------------------|
| 主食 | 白米饭28g、玄米34g、面条25g | 高碳水 |
| 蛋白质 | 鸡蛋0.6g、鱼0g、豆腐4g | 低碳水 |
| 蔬菜 | 西兰花7g、黄瓜3g、菠菜3g | 低碳水 |
| 水果 | 香蕉23g、苹果14g、草莓8g | 中高碳水 |

**如何使用**：
```
1. 点击 ➕ 添加记录
2. 在食物输入框输入：玄米饭、鸡蛋、西兰花
3. 实时显示：💡 碳水估算：约 42g | 玄米(34g)、西兰花(7g)
4. 如果早餐超过30g，会提示：⚠️ 早餐建议<30g
```

**碳水建议标准**：
- 🌅 **早餐**：15-30g（早晨血糖难控制）
- ☀️ **午餐**：45-60g
- 🌙 **晚餐**：45-60g
- 🍎 **加餐**：15-30g

**智能提示**：
- 🟢 ≤15g：✅ 控制良好
- 🟡 早餐>30g：⚠️ 早餐建议<30g
- 🟡 午晚餐>60g：⚠️ 建议<60g

---

### 3. 🔍 个性化食物-血糖关联分析

**解决痛点**：不知道哪些食物导致自己血糖升高

**功能描述**：
- 📈 **自动分析历史数据**：找出每种食物对您血糖的影响
- 🎯 **个性化洞察**：每个人对食物的反应不同
- ⚠️ **高血糖触发食物**：显示哪些食物让您血糖升高
- ✅ **友好食物推荐**：显示哪些食物适合您

**分析逻辑**：
1. 收集所有历史记录中的食物和血糖值
2. 计算每种食物的：
   - 平均餐后血糖
   - 出现次数
   - 超标次数和超标率
3. 至少吃过2次的食物才会分析
4. 按平均血糖排序

**洞察示例**：

**⚠️ 高血糖触发食物：**
```
「饺子」可能升糖较高
吃过 5 次，平均餐后血糖 135 mg/dL，超标率 80%。
建议减少摄入或搭配低GI食物。
```

**✅ 友好食物：**
```
「玄米」对您很友好
吃过 8 次，平均餐后血糖 108 mg/dL，控糖效果很好！
可以继续保持。
```

**如何查看**：
```
1. 点击底部"统计"标签
2. 滚动到"💡 个性化食物洞察"部分
3. 查看分析结果
```

**动态更新**：
- 每次保存新记录后自动更新
- 数据越多，分析越准确
- 需要至少记录同一种食物2次以上

---

## 📊 三大功能对比市场产品

| 功能 | 糖妈日记 v2.1 | 市场产品（SNAQ/Malama等） |
|------|--------------|--------------------------|
| **餐后提醒** | ✅ 免费，本地通知 | ✅ 有，但部分收费 |
| **碳水计算** | ✅ 免费，实时显示 | ✅ 有，AI识别需付费 |
| **个性化洞察** | ✅ **独家**，自动分析 | ⚠️ 部分产品有，需AI会员 |
| **硬件依赖** | 🟢 无需任何设备 | 🔴 多数需购买血糖仪 |
| **价格** | 🟢 完全免费 | 🔴 高级功能收费 |
| **数据隐私** | 🟢 本地存储 | 🟡 云端存储 |

**我们的独特价值**：
- 🎯 **个性化食物洞察** - 市场首创，完全基于您的数据
- 🆓 **完全免费** - 无任何隐藏收费
- 🔒 **完全隐私** - 所有分析在本地完成

---

## 🛠️ 技术改进

### 新增函数和功能

**通知系统**：
- `requestNotificationPermission()` - 请求通知权限
- `showNotification(title, body)` - 显示通知
- `scheduleGlucoseReminder(mealType, mealTime, selectedDate)` - 设置餐后提醒
- `toggleNotification()` - 开关提醒
- `updateNotificationButton()` - 更新按钮状态

**碳水分析**：
- `carbsDatabase` - 100+种食物碳水数据库
- `calculateCarbs(foodName)` - 识别食物碳水
- `analyzeMealCarbs(foodsText)` - 分析一餐碳水总量
- `updateCarbsHint(mealType)` - 实时更新碳水提示

**食物洞察**：
- `analyzeFoodGlucoseCorrelation()` - 分析食物-血糖关联
- `renderFoodInsights()` - 渲染洞察卡片

---

## 📱 使用场景示例

### 场景1：早上记录早餐

```
【08:00 吃完早餐】
1. 打开应用 → 点击 ➕
2. 填写：
   - 早餐食物：玄米饭、鸡蛋、西兰花
   - 用餐时间：08:00

【实时显示】
💡 碳水估算：约 42g ✅ 控制良好
玄米(34g)、西兰花(7g)

3. 点击保存
4. 弹窗：是否开启餐后血糖测量提醒？→ 点击"确定"

【09:00 收到提醒】
🩸 血糖测量提醒
早餐后1小时了，该测血糖了！
目标：<140 mg/dL
```

### 场景2：查看个性化洞察

```
【记录了2周数据后】
1. 点击"统计"标签
2. 滚动到"💡 个性化食物洞察"
3. 看到分析结果：

⚠️「白米饭」可能升糖较高
吃过 6 次，平均餐后血糖 142 mg/dL，超标率 83%。
建议减少摄入或搭配低GI食物。

✅「玄米」对您很友好
吃过 10 次，平均餐后血糖 110 mg/dL，控糖效果很好！

【根据洞察调整】
从此改吃玄米，不吃白米饭
```

### 场景3：在日本使用（多语言）

```
1. 切换到日语界面
2. 提醒也自动变为日语：
   🩸 血糖値測定リマインダー
   朝食後1時間です。血糖値を測定してください！
   目標：<140 mg/dL
```

---

## 🎯 对比 v2.0 的改进

| 维度 | v2.0 | v2.1 | 提升 |
|------|------|------|------|
| **提醒功能** | ❌ 无 | ✅ 智能餐后提醒 | 🆕 新增 |
| **碳水参考** | ⚠️ 仅GI值 | ✅ 实时碳水计算 | ⬆️ 增强 |
| **数据分析** | ⚠️ 基础统计 | ✅ 个性化洞察 | ⬆️ 大幅提升 |
| **用户体验** | 🟡 手动记忆 | ✅ 自动提醒+智能建议 | ⬆️ 显著改善 |

---

## ⚠️ 重要提示

### 1. 通知权限

**如何开启**：
- iOS Safari：设置 → Safari → 网站设置 → 通知 → 允许
- Android Chrome：自动弹窗询问，点击"允许"即可
- 电脑浏览器：地址栏左侧🔔图标 → 允许通知

**如果被拒绝**：
- 需要在浏览器设置中手动允许本网站的通知权限

### 2. 碳水估算说明

- 数据来源：公开的营养成分数据库
- 估算基础：假设每份约100g
- 仅供参考：实际摄入量因人而异
- 建议：配合食物秤更准确

### 3. 个性化洞察限制

- 需要同一食物至少记录2次
- 数据越多越准确
- 分析结果仅供参考
- 请结合医生建议

---

## 📖 新功能位置指南

### 智能提醒
**位置**：指南页面 → "⏰ 智能提醒"卡片
**操作**：点击"开启餐后提醒"按钮

### 碳水估算
**位置**：添加记录时，食物输入框下方
**显示**：自动显示，无需操作

### 食物洞察
**位置**：统计页面 → "💡 个性化食物洞察"
**更新**：每次保存记录后自动更新

---

## 🔮 未来规划（v2.2+）

### 近期计划（1个月内）
- [ ] 健康教育知识库（中日英三语）
- [ ] PDF报告生成（给医生看）
- [ ] 更多可视化图表

### 中期计划（2-3个月）
- [ ] 运动建议（基于步数和血糖）
- [ ] 食物替代建议（高GI→低GI）
- [ ] 周报/月报邮件推送

### 长期愿景（评估中）
- [ ] AI拍照识别食物（需评估成本）
- [ ] 社区功能（匿名经验分享）
- [ ] 血糖仪蓝牙集成

---

## 🆘 常见问题（FAQ）

### Q1: 为什么没有收到提醒？
**A**: 请检查：
1. 是否允许了浏览器通知权限
2. 是否填写了用餐时间
3. 是否已开启提醒功能（在"指南"页面查看）
4. 提醒只为今天和未来的餐次设置，过去的不会提醒

### Q2: 碳水估算准确吗？
**A**: 仅供参考。我们基于公开数据库，假设每份100g。实际摄入量因人而异，建议配合食物秤使用。

### Q3: 为什么没有个性化洞察？
**A**: 需要满足条件：
- 同一种食物至少记录2次
- 记录时填写了血糖值
- 数据越多，洞察越准确

### Q4: 提醒会消耗流量吗？
**A**: 不会。所有提醒完全在本地运行，不需要网络连接。

### Q5: 可以自定义提醒时间吗？
**A**: 当前版本固定为餐后1小时和2小时。后续版本会考虑添加自定义功能。

---

## 💬 反馈渠道

### 发现问题或建议
- **GitHub Issues**: https://github.com/KKAIlab/tangma-diary/issues
- 提供信息：问题描述、浏览器版本、设备类型

---

## ❤️ 致谢

感谢所有使用糖妈日记的准妈妈们！

v2.1的三大智能功能，完全基于市场调研和用户需求打造：
- ⏰ 智能提醒 - 解决"忘记测血糖"
- 💡 碳水参考 - 解决"不知道吃什么"
- 🔍 个性化洞察 - 解决"不知道为什么血糖高"

我们的目标是成为**最智能、最贴心、最适合在日中国准妈妈**的血糖管理助手。

**祝您健康平安，顺利迎接宝宝的到来！** 🤰✨

---

**版本**：v2.1 (智能辅助版)
**发布日期**：2025-12-19
**部署状态**：即将上线
**访问地址**：https://kkailab.github.io/tangma-diary/

🎊 **更新后请刷新页面，立即体验新功能！**
