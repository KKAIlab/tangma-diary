<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç³–å¦ˆæ—¥è®° - å¦Šå¨ æœŸç³–å°¿ç—…ç®¡ç†</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #FF6B9D;
            --primary-light: #FFE4EC;
            --primary-dark: #E84C7A;
            --success: #4ECDC4;
            --success-light: #E8FAF8;
            --warning: #FFB347;
            --warning-light: #FFF4E6;
            --danger: #FF6B6B;
            --danger-light: #FFE8E8;
            --text: #2D3436;
            --text-light: #636E72;
            --bg: #FFF9FB;
            --card: #FFFFFF;
            --border: #F0E6EA;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Noto Sans SC', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding-bottom: 90px;
        }
        .header-bg {
            position: fixed; top: 0; left: 0; right: 0; height: 180px;
            background: linear-gradient(135deg, var(--primary) 0%, #FF8FB1 100%);
            border-radius: 0 0 30px 30px;
            z-index: 0;
        }
        .container { position: relative; z-index: 1; max-width: 480px; margin: 0 auto; padding: 16px; }
        .header { color: white; padding: 8px 0 24px; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .logo { font-size: 1.4rem; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .logo-icon { width: 32px; height: 32px; background: rgba(255,255,255,0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center; }
        .header-btn { width: 36px; height: 36px; background: rgba(255,255,255,0.2); border: none; border-radius: 10px; color: white; font-size: 1.1rem; cursor: pointer; }
        .greeting { font-size: 1rem; opacity: 0.9; }
        
        /* æ¦‚è§ˆå¡ç‰‡ */
        .overview-card {
            background: var(--card);
            border-radius: 20px;
            padding: 16px;
            margin-top: 8px;
            box-shadow: 0 8px 30px rgba(255,107,157,0.15);
        }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .stat-item { text-align: center; padding: 14px 10px; background: var(--bg); border-radius: 14px; }
        .stat-icon { width: 40px; height: 40px; margin: 0 auto 8px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
        .stat-icon.pink { background: var(--primary-light); }
        .stat-icon.green { background: var(--success-light); }
        .stat-icon.orange { background: var(--warning-light); }
        .stat-icon.blue { background: #E8F4FD; }
        .stat-value { font-size: 1.4rem; font-weight: 700; }
        .stat-value .unit { font-size: 0.75rem; font-weight: 400; color: var(--text-light); }
        .stat-label { font-size: 0.75rem; color: var(--text-light); margin-top: 2px; }
        
        /* æ—¥æœŸé€‰æ‹©å™¨ */
        .date-selector {
            display: flex; gap: 8px; overflow-x: auto; padding: 16px 0;
            margin: 0 -16px; padding-left: 16px; padding-right: 16px;
            scrollbar-width: none;
        }
        .date-selector::-webkit-scrollbar { display: none; }
        .date-item {
            flex-shrink: 0; width: 52px; padding: 10px 6px;
            background: var(--card); border: 2px solid var(--border);
            border-radius: 14px; text-align: center; cursor: pointer;
        }
        .date-item.active { background: var(--primary); border-color: var(--primary); color: white; }
        .date-item.has-data::after {
            content: ''; display: block; width: 5px; height: 5px;
            background: var(--success); border-radius: 50%; margin: 4px auto 0;
        }
        .date-item.active.has-data::after { background: white; }
        .date-weekday { font-size: 0.65rem; color: var(--text-light); margin-bottom: 2px; }
        .date-item.active .date-weekday { color: rgba(255,255,255,0.8); }
        .date-day { font-size: 1.1rem; font-weight: 700; }
        
        /* åŒºå— */
        .section-header { display: flex; justify-content: space-between; align-items: center; margin: 20px 0 12px; }
        .section-title { font-size: 1rem; font-weight: 700; display: flex; align-items: center; gap: 6px; }
        .section-action { font-size: 0.8rem; color: var(--primary); text-decoration: none; font-weight: 500; }
        
        /* æ¯æ—¥æ€»ç»“ */
        .summary-card {
            background: linear-gradient(135deg, var(--primary) 0%, #FF8FB1 100%);
            border-radius: 18px; padding: 16px; color: white; margin-bottom: 16px;
        }
        .summary-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .summary-title { font-weight: 700; font-size: 1rem; }
        .summary-badge { background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 16px; font-size: 0.75rem; }
        .summary-stats { display: flex; gap: 12px; }
        .summary-stat { flex: 1; text-align: center; padding: 10px; background: rgba(255,255,255,0.15); border-radius: 10px; }
        .summary-stat-value { font-size: 1.2rem; font-weight: 700; }
        .summary-stat-label { font-size: 0.7rem; opacity: 0.9; margin-top: 2px; }
        
        /* ä¸‰é¤å¡ç‰‡ */
        .meal-card {
            background: var(--card); border-radius: 18px; padding: 16px;
            box-shadow: 0 4px 20px rgba(255,107,157,0.1); margin-bottom: 12px;
        }
        .meal-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .meal-info { display: flex; align-items: center; gap: 10px; }
        .meal-icon { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; }
        .meal-icon.breakfast { background: linear-gradient(135deg, #FFE4B5 0%, #FFD700 100%); }
        .meal-icon.lunch { background: linear-gradient(135deg, #98FB98 0%, #32CD32 100%); }
        .meal-icon.dinner { background: linear-gradient(135deg, #DDA0DD 0%, #9370DB 100%); }
        .meal-name { font-weight: 700; font-size: 0.95rem; }
        .meal-time { font-size: 0.75rem; color: var(--text-light); }
        .glucose-value { font-size: 1.3rem; font-weight: 700; }
        .glucose-value.normal { color: var(--success); }
        .glucose-value.warning { color: var(--warning); }
        .glucose-value.high { color: var(--danger); }
        .glucose-label { font-size: 0.7rem; color: var(--text-light); text-align: right; }
        .meal-foods { background: var(--bg); border-radius: 10px; padding: 10px; margin-bottom: 10px; }
        .food-tags { display: flex; flex-wrap: wrap; gap: 6px; }
        .food-tag {
            display: inline-flex; align-items: center; gap: 4px;
            padding: 5px 8px; background: white; border-radius: 16px;
            font-size: 0.75rem; border: 1px solid var(--border);
        }
        .gi-dot { width: 6px; height: 6px; border-radius: 50%; }
        .gi-dot.low { background: var(--success); }
        .gi-dot.medium { background: var(--warning); }
        .gi-dot.high { background: var(--danger); }
        .meal-analysis { display: flex; gap: 10px; padding-top: 10px; border-top: 1px dashed var(--border); }
        .analysis-item { flex: 1; text-align: center; padding: 6px; background: var(--bg); border-radius: 8px; }
        .analysis-value { font-size: 0.9rem; font-weight: 700; }
        .analysis-label { font-size: 0.65rem; color: var(--text-light); }
        
        /* å»ºè®®å¡ç‰‡ */
        .advice-card {
            background: var(--card); border-radius: 14px; padding: 14px;
            display: flex; gap: 12px; margin-bottom: 10px;
            box-shadow: 0 4px 20px rgba(255,107,157,0.1);
        }
        .advice-card.success { border-left: 4px solid var(--success); }
        .advice-card.warning { border-left: 4px solid var(--warning); }
        .advice-card.danger { border-left: 4px solid var(--danger); }
        .advice-card.info { border-left: 4px solid var(--primary); }
        .advice-icon { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0; }
        .advice-card.success .advice-icon { background: var(--success-light); }
        .advice-card.warning .advice-icon { background: var(--warning-light); }
        .advice-card.danger .advice-icon { background: var(--danger-light); }
        .advice-card.info .advice-icon { background: var(--primary-light); }
        .advice-title { font-weight: 700; font-size: 0.9rem; margin-bottom: 2px; }
        .advice-text { font-size: 0.8rem; color: var(--text-light); line-height: 1.4; }
        
        /* GIæœç´¢ */
        .gi-search-card { background: var(--card); border-radius: 18px; padding: 16px; box-shadow: 0 4px 20px rgba(255,107,157,0.1); margin-bottom: 16px; }
        .search-wrapper { display: flex; gap: 10px; margin-bottom: 14px; }
        .search-input { flex: 1; padding: 12px 14px; border: 2px solid var(--border); border-radius: 12px; font-size: 0.95rem; font-family: inherit; }
        .search-input:focus { outline: none; border-color: var(--primary); }
        .camera-btn { width: 48px; height: 48px; background: var(--primary); border: none; border-radius: 12px; color: white; font-size: 1.2rem; cursor: pointer; }
        .gi-result-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--bg); border-radius: 10px; margin-bottom: 8px; }
        .gi-food-info { display: flex; align-items: center; gap: 10px; }
        .gi-food-icon { width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; }
        .gi-food-icon.low { background: var(--success-light); }
        .gi-food-icon.medium { background: var(--warning-light); }
        .gi-food-icon.high { background: var(--danger-light); }
        .gi-food-name { font-weight: 500; font-size: 0.9rem; }
        .gi-food-category { font-size: 0.7rem; color: var(--text-light); }
        .gi-value { font-weight: 700; font-size: 1rem; }
        .gi-value.low { color: var(--success); }
        .gi-value.medium { color: var(--warning); }
        .gi-value.high { color: var(--danger); }
        .gl-value { font-size: 0.7rem; color: var(--text-light); }
        
        /* æŒ‡å— */
        .guide-card { background: var(--card); border-radius: 18px; padding: 16px; box-shadow: 0 4px 20px rgba(255,107,157,0.1); margin-bottom: 14px; }
        .guide-title { font-weight: 700; font-size: 0.95rem; margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
        .guide-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        .guide-table th, .guide-table td { padding: 8px 6px; text-align: left; border-bottom: 1px solid var(--border); }
        .guide-table th { color: var(--text-light); font-weight: 500; }
        .target-value { font-weight: 700; }
        .target-value.success { color: var(--success); }
        .target-value.warning { color: var(--warning); }
        .tip-box { margin-top: 10px; padding: 10px; border-radius: 8px; font-size: 0.8rem; }
        .tip-box.warning { background: var(--warning-light); }
        .tip-box.success { background: var(--success-light); }
        
        /* ç»Ÿè®¡å›¾è¡¨ */
        .chart-card { background: var(--card); border-radius: 18px; padding: 16px; box-shadow: 0 4px 20px rgba(255,107,157,0.1); margin-bottom: 14px; }
        .chart-title { font-weight: 700; font-size: 0.95rem; margin-bottom: 12px; }
        .chart-container { height: 180px; }
        .meal-avg-grid { display: flex; gap: 10px; margin-top: 14px; }
        .meal-avg-item { flex: 1; text-align: center; padding: 12px 8px; border-radius: 10px; }
        .meal-avg-value { font-size: 1.3rem; font-weight: 700; }
        .meal-avg-label { font-size: 0.7rem; color: var(--text-light); margin-top: 2px; }
        .meal-avg-status { font-size: 0.7rem; margin-top: 4px; }
        
        /* å‘¨æ•°æ®è¡¨æ ¼ */
        .week-table { overflow-x: auto; margin: 12px 0; }
        .week-table table { width: 100%; min-width: 500px; border-collapse: collapse; font-size: 0.75rem; }
        .week-table th, .week-table td { padding: 8px 5px; text-align: center; border: 1px solid var(--border); }
        .week-table th { background: var(--bg); font-weight: 600; color: var(--text-light); }
        .glucose-cell.normal { background: var(--success-light); color: #2a9d8f; font-weight: 600; }
        .glucose-cell.warning { background: var(--warning-light); color: #e68a00; font-weight: 600; }
        .glucose-cell.high { background: var(--danger-light); color: var(--danger); font-weight: 600; }
        
        /* åº•éƒ¨å¯¼èˆª */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: var(--card); border-top: 1px solid var(--border);
            padding: 8px 16px 20px; display: flex; justify-content: space-around; z-index: 100;
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 2px; padding: 6px 14px; background: none; border: none; color: var(--text-light); font-size: 0.7rem; cursor: pointer; }
        .nav-item.active { color: var(--primary); }
        .nav-icon { font-size: 1.3rem; }
        .nav-add { width: 52px; height: 52px; background: var(--primary); border: none; border-radius: 50%; color: white; font-size: 1.6rem; cursor: pointer; margin-top: -26px; box-shadow: 0 4px 20px rgba(255,107,157,0.3); }
        
        /* æ¨¡æ€æ¡† */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: none; align-items: flex-end; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .modal-content { background: var(--card); border-radius: 20px 20px 0 0; width: 100%; max-width: 480px; max-height: 85vh; overflow-y: auto; padding: 20px; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .modal-title { font-size: 1.1rem; font-weight: 700; }
        .modal-close { width: 32px; height: 32px; background: var(--bg); border: none; border-radius: 50%; font-size: 1.1rem; cursor: pointer; }
        .photo-upload-area { border: 2px dashed var(--border); border-radius: 14px; padding: 36px 16px; text-align: center; cursor: pointer; }
        .photo-upload-area.has-image { padding: 0; border-style: solid; }
        .photo-upload-area img { width: 100%; border-radius: 12px; }
        .upload-icon { font-size: 2.5rem; margin-bottom: 10px; }
        .upload-text { color: var(--text-light); font-size: 0.9rem; }
        .upload-hint { color: var(--primary); font-size: 0.8rem; margin-top: 6px; font-weight: 500; }
        .analysis-result { background: var(--bg); border-radius: 14px; padding: 16px; margin-top: 16px; display: none; }
        .analysis-result.show { display: block; }
        
        /* é¡µé¢åˆ‡æ¢ */
        .page { display: none; }
        .page.active { display: block; }
        .hidden-input { display: none; }
    </style>
</head>
<body>
    <div class="header-bg"></div>
    <div class="container">
        <!-- é¦–é¡µ -->
        <div class="page active" id="page-home">
            <div class="header">
                <div class="header-top">
                    <div class="logo"><div class="logo-icon">ğŸ¤°</div><span>ç³–å¦ˆæ—¥è®°</span></div>
                    <div style="display:flex;gap:8px;">
                        <button class="header-btn" onclick="showPage('page-guide')">ğŸ“‹</button>
                        <button class="header-btn" onclick="showPage('page-stats')">ğŸ“Š</button>
                    </div>
                </div>
                <div class="greeting" id="current-date">2025å¹´12æœˆ17æ—¥ å‘¨äºŒ</div>
            </div>
            
            <div class="overview-card">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-icon pink">ğŸ¯</div>
                        <div class="stat-value" id="compliance-rate">68%</div>
                        <div class="stat-label">æœ¬å‘¨è¾¾æ ‡ç‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon green">ğŸ“‰</div>
                        <div class="stat-value" id="avg-glucose">118<span class="unit">mg/dL</span></div>
                        <div class="stat-label">å¹³å‡é¤åè¡€ç³–</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon orange">âš–ï¸</div>
                        <div class="stat-value" id="weight-display">67.7<span class="unit">kg</span></div>
                        <div class="stat-label">ä»Šæ—¥ä½“é‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon blue">ğŸ‘£</div>
                        <div class="stat-value" id="steps-display">5144<span class="unit">æ­¥</span></div>
                        <div class="stat-label">ä»Šæ—¥æ­¥æ•°</div>
                    </div>
                </div>
            </div>
            
            <div class="date-selector" id="date-selector"></div>
            
            <div class="summary-card" id="daily-summary">
                <div class="summary-header">
                    <div class="summary-title">ğŸ“Š ä»Šæ—¥å°ç»“</div>
                    <div class="summary-badge" id="summary-badge">éœ€è¦å…³æ³¨</div>
                </div>
                <div class="summary-stats">
                    <div class="summary-stat">
                        <div class="summary-stat-value" id="summary-meals">3</div>
                        <div class="summary-stat-label">è®°å½•é¤æ•°</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-value" id="summary-normal">2</div>
                        <div class="summary-stat-label">è¾¾æ ‡æ¬¡æ•°</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-value" id="summary-high">1</div>
                        <div class="summary-stat-label">è¶…æ ‡æ¬¡æ•°</div>
                    </div>
                </div>
            </div>
            
            <div class="section-header">
                <div class="section-title">ğŸ½ï¸ ä»Šæ—¥é¥®é£Ÿ</div>
                <a href="#" class="section-action" onclick="showModal('add-meal-modal')">+ æ·»åŠ </a>
            </div>
            <div id="meal-cards"></div>
            
            <div class="section-header">
                <div class="section-title">ğŸ’¡ ä»Šæ—¥å»ºè®®</div>
            </div>
            <div id="advice-cards"></div>
        </div>
        
        <!-- GIæŸ¥è¯¢é¡µé¢ -->
        <div class="page" id="page-gi">
            <div class="header">
                <div class="header-top">
                    <div class="logo"><div class="logo-icon">ğŸ”</div><span>é£Ÿç‰©GIæŸ¥è¯¢</span></div>
                </div>
                <div class="greeting">æŸ¥è¯¢é£Ÿç‰©çš„å‡ç³–æŒ‡æ•°</div>
            </div>
            
            <div class="gi-search-card">
                <div class="search-wrapper">
                    <input type="text" class="search-input" id="gi-search-input" placeholder="è¾“å…¥é£Ÿç‰©åç§°æœç´¢...">
                    <button class="camera-btn" onclick="showModal('photo-modal')">ğŸ“·</button>
                </div>
                <div id="gi-results"></div>
            </div>
            
            <div class="guide-card">
                <div class="guide-title">ğŸ“š GIå€¼åˆ†ç±»æ ‡å‡†</div>
                <table class="guide-table">
                    <tr><th>åˆ†ç±»</th><th>GIå€¼</th><th>å»ºè®®</th></tr>
                    <tr><td><span style="color:var(--success);">â—</span> ä½GI</td><td class="target-value success">â‰¤55</td><td>ä¼˜å…ˆé€‰æ‹©</td></tr>
                    <tr><td><span style="color:var(--warning);">â—</span> ä¸­GI</td><td class="target-value warning">56-70</td><td>é€‚é‡é£Ÿç”¨</td></tr>
                    <tr><td><span style="color:var(--danger);">â—</span> é«˜GI</td><td class="target-value" style="color:var(--danger);">>70</td><td>å°½é‡é¿å…</td></tr>
                </table>
            </div>
            
            <div class="section-header"><div class="section-title">â­ å¸¸è§é£Ÿç‰©</div></div>
            <div class="gi-search-card"><div id="common-foods"></div></div>
        </div>
        
        <!-- æŒ‡å—é¡µé¢ -->
        <div class="page" id="page-guide">
            <div class="header">
                <div class="header-top">
                    <div class="logo"><div class="logo-icon">ğŸ“‹</div><span>æ§ç³–æŒ‡å—</span></div>
                </div>
                <div class="greeting">åŸºäºä¸­æ—¥ç¾ä¸´åºŠæŒ‡å—</div>
            </div>
            
            <div class="guide-card">
                <div class="guide-title">ğŸ¯ è¡€ç³–æ§åˆ¶ç›®æ ‡</div>
                <table class="guide-table">
                    <tr><th>ç›‘æµ‹æ—¶é—´</th><th>ç›®æ ‡å€¼</th><th>æ‚¨çš„å‡å€¼</th></tr>
                    <tr><td>ç©ºè…¹è¡€ç³–</td><td class="target-value success">&lt;95 mg/dL</td><td id="guide-fasting">88</td></tr>
                    <tr><td>é¤å1å°æ—¶</td><td class="target-value success">&lt;140 mg/dL</td><td>-</td></tr>
                    <tr><td>é¤å2å°æ—¶</td><td class="target-value success">&lt;120 mg/dL</td><td id="guide-postmeal">118</td></tr>
                </table>
            </div>
            
            <div class="guide-card">
                <div class="guide-title">ğŸš æ¯æ—¥ç¢³æ°´åˆ†é…</div>
                <table class="guide-table">
                    <tr><th>é¤æ¬¡</th><th>çƒ­é‡å æ¯”</th><th>ç¢³æ°´å»ºè®®</th></tr>
                    <tr><td>æ—©é¤ ğŸŒ…</td><td>10-15%</td><td class="target-value warning">15-30g</td></tr>
                    <tr><td>åˆé¤ â˜€ï¸</td><td>30%</td><td class="target-value">45-60g</td></tr>
                    <tr><td>æ™šé¤ ğŸŒ™</td><td>30%</td><td class="target-value">45-60g</td></tr>
                    <tr><td>åŠ é¤ ğŸ</td><td>5-10%</td><td class="target-value">15-30g</td></tr>
                </table>
                <div class="tip-box warning">âš ï¸ <strong>æ—©é¤æç¤º</strong>ï¼šæ¸…æ™¨çš®è´¨é†‡è¾ƒé«˜ï¼Œè¡€ç³–æ›´éš¾æ§åˆ¶ã€‚å»ºè®®æ—©é¤ç¢³æ°´æ§åˆ¶åœ¨15-20gï¼Œé¿å…æ°´æœå’Œæœæ±ã€‚</div>
            </div>
            
            <div class="guide-card">
                <div class="guide-title">ğŸƒâ€â™€ï¸ è¿åŠ¨å»ºè®®</div>
                <table class="guide-table">
                    <tr><th>é¡¹ç›®</th><th>æ¨èå€¼</th></tr>
                    <tr><td>æ¯å‘¨è¿åŠ¨æ—¶é—´</td><td class="target-value success">â‰¥150åˆ†é’Ÿ</td></tr>
                    <tr><td>æ¯æ—¥æ­¥æ•°ç›®æ ‡</td><td class="target-value success">â‰¥6000æ­¥</td></tr>
                    <tr><td>é¤åè¿åŠ¨æ—¶æœº</td><td class="target-value">é¤å15åˆ†é’Ÿå¼€å§‹</td></tr>
                    <tr><td>æ¯æ¬¡è¿åŠ¨æ—¶é•¿</td><td class="target-value">20-30åˆ†é’Ÿ</td></tr>
                </table>
                <div class="tip-box success">âœ… <strong>é¤åæ•£æ­¥</strong>ï¼šç ”ç©¶æ˜¾ç¤ºé¤å20åˆ†é’Ÿæ•£æ­¥å¯ä½¿è¡€ç³–å¹³å‡ä¸‹é™0.22 mmol/L</div>
            </div>
            
            <div class="guide-card">
                <div class="guide-title">ğŸ’¾ æ•°æ®ç®¡ç†</div>
                <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:10px;">
                    <button onclick="exportData()" style="padding:12px;background:var(--primary);color:white;border:none;border-radius:10px;font-size:0.85rem;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;">
                        <span style="font-size:1.1rem;">ğŸ“¤</span><span>å¯¼å‡ºæ•°æ®</span>
                    </button>
                    <button onclick="document.getElementById('import-file').click()" style="padding:12px;background:var(--success);color:white;border:none;border-radius:10px;font-size:0.85rem;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;">
                        <span style="font-size:1.1rem;">ğŸ“¥</span><span>å¯¼å…¥æ•°æ®</span>
                    </button>
                </div>
                <button onclick="clearAllData()" style="width:100%;padding:10px;background:var(--danger-light);color:var(--danger);border:2px solid var(--danger);border-radius:10px;font-size:0.85rem;cursor:pointer;">
                    ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•°æ®
                </button>
                <input type="file" id="import-file" accept=".json" style="display:none;" onchange="importData(this.files[0])">
                <div style="margin-top:12px;padding:10px;background:var(--bg);border-radius:8px;font-size:0.75rem;color:var(--text-light);">
                    ğŸ’¡ <strong>æç¤ºï¼š</strong>å®šæœŸå¯¼å‡ºæ•°æ®å¤‡ä»½ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚å¯¼å‡ºçš„JSONæ–‡ä»¶å¯åœ¨å…¶ä»–è®¾å¤‡å¯¼å…¥ã€‚
                </div>
            </div>

            <div class="guide-card">
                <div class="guide-title">ğŸ“– è¿›é¤é¡ºåº</div>
                <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap;padding:8px 0;">
                    <span style="background:var(--success-light);padding:6px 12px;border-radius:16px;font-size:0.85rem;">1ï¸âƒ£ è”¬èœ</span>
                    <span style="font-size:1.1rem;">â†’</span>
                    <span style="background:var(--primary-light);padding:6px 12px;border-radius:16px;font-size:0.85rem;">2ï¸âƒ£ è›‹ç™½è´¨</span>
                    <span style="font-size:1.1rem;">â†’</span>
                    <span style="background:var(--warning-light);padding:6px 12px;border-radius:16px;font-size:0.85rem;">3ï¸âƒ£ ä¸»é£Ÿ</span>
                </div>
                <div style="color:var(--text-light);font-size:0.8rem;margin-top:6px;">å…ˆåƒè”¬èœå’Œè›‹ç™½è´¨å¯å‡ç¼“ç¢³æ°´å¸æ”¶ï¼Œé™ä½è¡€ç³–å³°å€¼</div>
            </div>
        </div>
        
        <!-- ç»Ÿè®¡é¡µé¢ -->
        <div class="page" id="page-stats">
            <div class="header">
                <div class="header-top">
                    <div class="logo"><div class="logo-icon">ğŸ“Š</div><span>æ•°æ®ç»Ÿè®¡</span></div>
                </div>
                <div class="greeting">12æœˆ5æ—¥ - 12æœˆ17æ—¥ å‘¨æŠ¥</div>
            </div>
            
            <div class="chart-card">
                <div class="chart-title">ğŸ“ˆ é¤åè¡€ç³–è¶‹åŠ¿</div>
                <div class="chart-container"><canvas id="glucose-chart"></canvas></div>
            </div>
            
            <div class="chart-card">
                <div class="chart-title">ğŸ½ï¸ ä¸‰é¤è¡€ç³–åˆ†æ</div>
                <div class="meal-avg-grid">
                    <div class="meal-avg-item" style="background:var(--warning-light);">
                        <div class="meal-avg-value" style="color:var(--warning);" id="breakfast-avg">127</div>
                        <div class="meal-avg-label">æ—©é¤åå‡å€¼</div>
                        <div class="meal-avg-status" style="color:var(--danger);">âš ï¸ åé«˜</div>
                    </div>
                    <div class="meal-avg-item" style="background:var(--warning-light);">
                        <div class="meal-avg-value" style="color:var(--warning);" id="lunch-avg">121</div>
                        <div class="meal-avg-label">åˆé¤åå‡å€¼</div>
                        <div class="meal-avg-status" style="color:var(--warning);">âš¡ ä¸´ç•Œ</div>
                    </div>
                    <div class="meal-avg-item" style="background:var(--success-light);">
                        <div class="meal-avg-value" style="color:var(--success);" id="dinner-avg">109</div>
                        <div class="meal-avg-label">æ™šé¤åå‡å€¼</div>
                        <div class="meal-avg-status" style="color:var(--success);">âœ“ è¾¾æ ‡</div>
                    </div>
                </div>
            </div>
            
            <div class="chart-card">
                <div class="chart-title">ğŸ“‹ æ¯æ—¥è¯¦ç»†æ•°æ®</div>
                <div class="week-table">
                    <table>
                        <thead><tr><th>æ—¥æœŸ</th><th>ä½“é‡</th><th>æ—©é¤å</th><th>åˆé¤å</th><th>æ™šé¤å</th><th>æ­¥æ•°</th></tr></thead>
                        <tbody id="week-table-body"></tbody>
                    </table>
                </div>
            </div>
            
            <div class="section-header"><div class="section-title">ğŸ” å…³é”®å‘ç°</div></div>
            <div class="advice-card warning">
                <div class="advice-icon">ğŸ³</div>
                <div><div class="advice-title">æ—©é¤è¡€ç³–æ§åˆ¶éœ€åŠ å¼º</div><div class="advice-text">æ—©é¤åè¡€ç³–å¹³å‡127mg/dLï¼Œè¶…æ ‡ç‡è¾¾60%ã€‚é¥ºå­ã€é¢åŒ…æ˜¯ä¸»è¦ç¢³æ°´æ¥æºï¼Œå»ºè®®å‡é‡æˆ–æ›¿æ¢ä¸ºä½GIé£Ÿç‰©ã€‚</div></div>
            </div>
            <div class="advice-card success">
                <div class="advice-icon">ğŸŒ™</div>
                <div><div class="advice-title">æ™šé¤æ§åˆ¶è‰¯å¥½</div><div class="advice-text">æ™šé¤åè¡€ç³–å¹³å‡109mg/dLï¼Œè¾¾æ ‡ç‡85%ã€‚ç„ç±³+è›‹ç™½è´¨+è”¬èœçš„æ­é…æ•ˆæœæ˜æ˜¾ï¼Œè¯·ç»§ç»­ä¿æŒï¼</div></div>
            </div>
            <div class="advice-card danger">
                <div class="advice-icon">ğŸš¶</div>
                <div><div class="advice-title">è¿åŠ¨é‡ä¸è¶³</div><div class="advice-text">æœ¬å‘¨å¹³å‡æ­¥æ•°5802æ­¥ï¼Œä½äº6000æ­¥ç›®æ ‡ã€‚11æ—¥ã€12æ—¥è®°å½•"æ²¡è¿åŠ¨"ï¼Œé¤åè¡€ç³–æ˜æ˜¾åé«˜ã€‚</div></div>
            </div>
            <div class="advice-card info">
                <div class="advice-icon">âš ï¸</div>
                <div><div class="advice-title">é»‘ä¾¿éœ€å…³æ³¨</div><div class="advice-text">7æ—¥ã€9æ—¥å‡ºç°é»‘è‰²å¤§ä¾¿ï¼Œå¯èƒ½ä¸è¡¥é“å‰‚æˆ–é¥®é£Ÿæœ‰å…³ã€‚å¦‚æŒç»­å‡ºç°è¯·åŠæ—¶å°±åŒ»æ£€æŸ¥ã€‚</div></div>
            </div>
        </div>
    </div>
    
    <!-- åº•éƒ¨å¯¼èˆª -->
    <div class="bottom-nav">
        <button class="nav-item active" onclick="showPage('page-home')" id="nav-home"><span class="nav-icon">ğŸ </span><span>é¦–é¡µ</span></button>
        <button class="nav-item" onclick="showPage('page-gi')" id="nav-gi"><span class="nav-icon">ğŸ”</span><span>GIæŸ¥è¯¢</span></button>
        <button class="nav-add" onclick="showModal('add-meal-modal')">+</button>
        <button class="nav-item" onclick="showPage('page-guide')" id="nav-guide"><span class="nav-icon">ğŸ“‹</span><span>æŒ‡å—</span></button>
        <button class="nav-item" onclick="showPage('page-stats')" id="nav-stats"><span class="nav-icon">ğŸ“Š</span><span>ç»Ÿè®¡</span></button>
    </div>
    
    <!-- æ‹ç…§åˆ†ææ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="photo-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ“· æ‹ç…§è¯†åˆ«é£Ÿç‰©</div>
                <button class="modal-close" onclick="hideModal('photo-modal')">âœ•</button>
            </div>
            <div class="photo-upload-area" id="photo-upload-area" onclick="document.getElementById('photo-input').click()">
                <div class="upload-icon">ğŸ“¸</div>
                <div class="upload-text">ç‚¹å‡»æ‹ç…§æˆ–é€‰æ‹©å›¾ç‰‡</div>
                <div class="upload-hint">AIå°†è‡ªåŠ¨è¯†åˆ«é£Ÿç‰©å¹¶åˆ†æGIå€¼</div>
            </div>
            <input type="file" class="hidden-input" id="photo-input" accept="image/*" capture="environment">
            <div class="analysis-result" id="analysis-result">
                <div style="font-weight:700;margin-bottom:12px;">ğŸ” è¯†åˆ«ç»“æœ</div>
                <div id="detected-foods"></div>
            </div>
        </div>
    </div>
    
    <!-- æ·»åŠ è®°å½•æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="add-meal-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ“ æ·»åŠ é¥®é£Ÿè®°å½•</div>
                <button class="modal-close" onclick="hideModal('add-meal-modal')">âœ•</button>
            </div>
            <div style="margin-bottom:14px;">
                <label style="font-size:0.85rem;color:var(--text-light);display:block;margin-bottom:6px;">é¤æ¬¡</label>
                <div style="display:flex;gap:8px;" id="meal-type-selector">
                    <button class="meal-type-btn active" data-type="breakfast" style="flex:1;padding:10px;border:2px solid var(--primary);background:var(--primary-light);border-radius:10px;font-size:0.85rem;cursor:pointer;">ğŸŒ… æ—©é¤</button>
                    <button class="meal-type-btn" data-type="lunch" style="flex:1;padding:10px;border:2px solid var(--border);background:white;border-radius:10px;font-size:0.85rem;cursor:pointer;">â˜€ï¸ åˆé¤</button>
                    <button class="meal-type-btn" data-type="dinner" style="flex:1;padding:10px;border:2px solid var(--border);background:white;border-radius:10px;font-size:0.85rem;cursor:pointer;">ğŸŒ™ æ™šé¤</button>
                </div>
            </div>
            <div style="margin-bottom:14px;">
                <label style="font-size:0.85rem;color:var(--text-light);display:block;margin-bottom:6px;">é£Ÿç‰©å†…å®¹</label>
                <textarea id="meal-foods-input" style="width:100%;padding:12px;border:2px solid var(--border);border-radius:10px;font-size:0.95rem;font-family:inherit;resize:none;height:80px;" placeholder="ä¾‹å¦‚ï¼šç„ç±³é¥­ã€é¸¡èƒ¸è‚‰ã€è¥¿å…°èŠ±...&#10;å¤šä¸ªé£Ÿç‰©ç”¨é€—å·æˆ–æ¢è¡Œåˆ†éš”"></textarea>
            </div>
            <div style="display:flex;gap:10px;margin-bottom:14px;">
                <div style="flex:1;">
                    <label style="font-size:0.85rem;color:var(--text-light);display:block;margin-bottom:6px;">é¤åè¡€ç³–</label>
                    <input type="number" id="meal-glucose-input" style="width:100%;padding:12px;border:2px solid var(--border);border-radius:10px;font-size:0.95rem;" placeholder="mg/dL">
                </div>
                <div style="flex:1;">
                    <label style="font-size:0.85rem;color:var(--text-light);display:block;margin-bottom:6px;">æµ‹é‡æ—¶é—´</label>
                    <input type="time" id="meal-time-input" style="width:100%;padding:12px;border:2px solid var(--border);border-radius:10px;font-size:0.95rem;">
                </div>
            </div>
            <button style="width:100%;padding:14px;background:var(--primary);color:white;border:none;border-radius:12px;font-size:0.95rem;font-weight:600;cursor:pointer;" id="save-meal-btn" onclick="saveMealRecord()">ä¿å­˜è®°å½•</button>
        </div>
    </div>

    <script>
        // localStorage ç®¡ç†
        const STORAGE_KEY = 'tangma_diary_data';
        const STORAGE_VERSION = '1.0';

        // ä¿å­˜æ•°æ®åˆ° localStorage
        function saveData() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify({
                    version: STORAGE_VERSION,
                    data: allData,
                    lastUpdate: new Date().toISOString()
                }));
                console.log('âœ… æ•°æ®å·²ä¿å­˜');
            } catch (e) {
                console.error('âŒ ä¿å­˜å¤±è´¥:', e);
                alert('æ•°æ®ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®');
            }
        }

        // ä» localStorage åŠ è½½æ•°æ®
        function loadData() {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    const parsed = JSON.parse(stored);
                    console.log('âœ… åŠ è½½å·²ä¿å­˜æ•°æ®ï¼Œæœ€åæ›´æ–°:', parsed.lastUpdate);
                    return parsed.data;
                }
            } catch (e) {
                console.error('âŒ åŠ è½½å¤±è´¥:', e);
            }
            console.log('ğŸ“ ä½¿ç”¨ç¤ºä¾‹æ•°æ®');
            return null;
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const dataStr = JSON.stringify({
                version: STORAGE_VERSION,
                exportDate: new Date().toISOString(),
                data: allData
            }, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `ç³–å¦ˆæ—¥è®°_${new Date().toISOString().slice(0,10)}.json`;
            link.click();
            URL.revokeObjectURL(url);
            alert('âœ… æ•°æ®å¯¼å‡ºæˆåŠŸï¼');
        }

        // å¯¼å…¥æ•°æ®
        function importData(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (imported.data && Array.isArray(imported.data)) {
                        if (confirm('ç¡®è®¤å¯¼å…¥æ•°æ®ï¼Ÿè¿™å°†è¦†ç›–å½“å‰æ‰€æœ‰è®°å½•ã€‚')) {
                            allData = imported.data;
                            saveData();
                            location.reload();
                        }
                    } else {
                        alert('âŒ æ•°æ®æ ¼å¼é”™è¯¯');
                    }
                } catch (err) {
                    alert('âŒ å¯¼å…¥å¤±è´¥: ' + err.message);
                }
            };
            reader.readAsText(file);
        }

        // æ¸…é™¤æ‰€æœ‰æ•°æ®ï¼ˆç”¨äºé‡ç½®ï¼‰
        function clearAllData() {
            if (confirm('âš ï¸ ç¡®è®¤æ¸…é™¤æ‰€æœ‰æ•°æ®ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼\n\nå»ºè®®å…ˆå¯¼å‡ºå¤‡ä»½ã€‚')) {
                if (confirm('ğŸ”´ å†æ¬¡ç¡®è®¤ï¼šçœŸçš„è¦åˆ é™¤æ‰€æœ‰è®°å½•å—ï¼Ÿ')) {
                    localStorage.removeItem(STORAGE_KEY);
                    location.reload();
                }
            }
        }

        // é»˜è®¤ç¤ºä¾‹æ•°æ®
        const defaultData = [
            { date: "12æœˆ5æ—¥", weekday: "å‘¨å››", weight: 68.3, fasting: 94, steps: null,
              meals: [{ type: "dinner", time: "17:54", foods: ["æ‚ç²®é¥­", "èŒ„å­é’æ¤’çŒªè‚‰", "é±¼", "å‘³å¢è±†è…"], glucose: 115 }] },
            { date: "12æœˆ6æ—¥", weekday: "å‘¨äº”", weight: 67.6, fasting: 88, steps: 6754,
              meals: [
                { type: "breakfast", time: "9:07", foods: ["é¢åŒ…", "è¥¿çº¢æŸ¿", "é¸¡è›‹", "é»‘è±†èŒ¶"], glucose: 110 },
                { type: "lunch", time: "12:20", foods: ["èŠ±è›¤æ±¤", "è±†è…", "é¸¡è‚‰", "è”¬èœ", "çº³è±†"], glucose: 141 },
                { type: "dinner", time: "18:24", foods: ["éº»è¾£çƒ«"], glucose: 96 }
              ] },
            { date: "12æœˆ7æ—¥", weekday: "å‘¨å…­", weight: 68.1, fasting: 85, steps: 6805, notes: "é»‘ä¾¿",
              meals: [
                { type: "breakfast", time: "10:24", foods: ["é¥ºå­", "ç´«èœæ±¤", "é»„ç“œ", "é¥¼å¹²"], glucose: 127 },
                { type: "lunch", time: "13:19", foods: ["é‡‘é’ˆè‡", "ç‰›è‚‰æ´‹è‘±", "é’èœ"], glucose: 127 },
                { type: "dinner", time: "18:48", foods: ["æµ·å¸¦ä¸", "æ¯›è±†", "æ’éª¨", "ç±³ç²‰"], glucose: 110 }
              ] },
            { date: "12æœˆ8æ—¥", weekday: "å‘¨æ—¥", weight: 67.8, fasting: 90, steps: 6789,
              meals: [
                { type: "breakfast", time: "9:04", foods: ["é¥ºå­", "æ©™å­", "ç•ªèŒ„"], glucose: 120 },
                { type: "lunch", time: "12:40", foods: ["ç‰›è‚‰", "é’èœ", "ç„ç±³"], glucose: 111 },
                { type: "dinner", time: "18:50", foods: ["é¸¡è‚‰", "é’èœ", "ç´«èœè±†è…æ±¤", "ç„ç±³"], glucose: 94 }
              ] },
            { date: "12æœˆ9æ—¥", weekday: "å‘¨ä¸€", weight: 68.1, fasting: 89, steps: 8051, notes: "é»‘ä¾¿",
              meals: [
                { type: "breakfast", time: "9:05", foods: ["é¥ºå­", "æ©˜å­"], glucose: 109 },
                { type: "lunch", time: "12:52", foods: ["é¸¡æ’", "è¥¿çº¢æŸ¿ç‚’è›‹", "è˜‘è‡æ±¤"], glucose: 116 },
                { type: "dinner", time: "17:55", foods: ["é¸¡å—", "èŠ±æ¤°èœå’–å–±", "ç„ç±³"], glucose: 114 }
              ] },
            { date: "12æœˆ10æ—¥", weekday: "å‘¨äºŒ", weight: 67.9, fasting: null, steps: 6795,
              meals: [{ type: "dinner", time: "18:58", foods: ["é»„ç“œ", "è±†è…", "é¸¡è‚‰ä¸¸å­æ±¤", "å¥‡å¼‚æœ"], glucose: 105 }] },
            { date: "12æœˆ11æ—¥", weekday: "å‘¨ä¸‰", weight: 67.9, fasting: null, steps: 5451, notes: "æ²¡è¿åŠ¨",
              meals: [
                { type: "breakfast", time: "11:33", foods: ["é¥ºå­", "æ©˜å­"], glucose: 134 },
                { type: "dinner", time: "18:21", foods: ["çº³è±†", "ç„ç±³", "è”¬èœç‰›è‚‰æ±¤", "é¸¡è‚‰"], glucose: 117 }
              ] },
            { date: "12æœˆ12æ—¥", weekday: "å‘¨å››", weight: 67.5, fasting: null, steps: 3254, notes: "æ²¡è¿åŠ¨",
              meals: [
                { type: "breakfast", time: "9:36", foods: ["é¢åŒ…", "é¸¡è›‹", "å¥‡å¼‚æœ", "é¥ºå­"], glucose: 127 },
                { type: "lunch", time: "12:54", foods: ["æ‹Œé¢", "èŒ„å­é’æ¤’"], glucose: 99 },
                { type: "dinner", time: "19:37", foods: ["è›‹åŒ…é¥­"], glucose: 114 }
              ] },
            { date: "12æœˆ13æ—¥", weekday: "å‘¨äº”", weight: null, fasting: null, steps: 4750,
              meals: [
                { type: "breakfast", time: "10:03", foods: ["(æœªè®°å½•)"], glucose: 135 },
                { type: "lunch", time: "13:15", foods: ["(æœªè®°å½•)"], glucose: 102 },
                { type: "dinner", time: "18:13", foods: ["(æœªè®°å½•)"], glucose: 120 }
              ] },
            { date: "12æœˆ14æ—¥", weekday: "å‘¨å…­", weight: 67.5, fasting: 120, steps: 7367,
              meals: [{ type: "lunch", time: "11:52", foods: ["(æœªè®°å½•)"], glucose: 131 }] },
            { date: "12æœˆ15æ—¥", weekday: "å‘¨æ—¥", weight: null, fasting: null, steps: 6721,
              meals: [
                { type: "breakfast", time: "8:50", foods: ["é¦’å¤´", "è‚‰æ¾", "ç‰›å¥¶"], glucose: 134 },
                { type: "lunch", time: "12:30", foods: ["é±¼", "ç±³é¥­", "è”¬èœæ±¤", "é¥¼å¹²"], glucose: 140 },
                { type: "dinner", time: "18:57", foods: ["çº³è±†", "èŠ±è›¤", "é¸¡è‚‰", "ç±³é¥­"], glucose: 111 }
              ] },
            { date: "12æœˆ16æ—¥", weekday: "å‘¨ä¸€", weight: 67.0, fasting: null, steps: null,
              meals: [
                { type: "breakfast", time: "10:03", foods: ["é¢åŒ…", "è±†è…", "èŒ¶ç¢—è’¸", "ç‰›å¥¶"], glucose: 134 },
                { type: "lunch", time: "14:32", foods: ["é¸¡æ’", "ç±³é¥­", "ç´«èœè›‹æ±¤"], glucose: 128 },
                { type: "dinner", time: "18:45", foods: ["é¸¡æ’", "ç™½èœ"], glucose: 113 }
              ] },
            { date: "12æœˆ17æ—¥", weekday: "å‘¨äºŒ", weight: 67.7, fasting: null, steps: 5144,
              meals: [{ type: "breakfast", time: "8:36", foods: ["è±†æµ†", "è’¸è›‹", "é¢åŒ…", "è¥¿çº¢æŸ¿"], glucose: null }] }
        ];

        // åˆå§‹åŒ–æ•°æ®ï¼šä¼˜å…ˆä½¿ç”¨ localStorageï¼Œå¦åˆ™ç”¨ç¤ºä¾‹æ•°æ®
        let allData = loadData() || defaultData;
        
        // GIæ•°æ®åº“
        const giDatabase = [
            { name: "ç™½ç±³é¥­", category: "ä¸»é£Ÿ", gi: 83, gl: 23, icon: "ğŸš" },
            { name: "ç„ç±³/ç³™ç±³", category: "ä¸»é£Ÿ", gi: 55, gl: 16, icon: "ğŸš" },
            { name: "æ‚ç²®é¥­", category: "ä¸»é£Ÿ", gi: 55, gl: 15, icon: "ğŸš" },
            { name: "ç™½é¦’å¤´", category: "ä¸»é£Ÿ", gi: 88, gl: 42, icon: "ğŸ¥–" },
            { name: "ç™½é¢åŒ…", category: "ä¸»é£Ÿ", gi: 75, gl: 10, icon: "ğŸ" },
            { name: "å…¨éº¦é¢åŒ…", category: "ä¸»é£Ÿ", gi: 51, gl: 7, icon: "ğŸ" },
            { name: "é¥ºå­", category: "ä¸»é£Ÿ", gi: 60, gl: 14, icon: "ğŸ¥Ÿ" },
            { name: "é¢æ¡", category: "ä¸»é£Ÿ", gi: 55, gl: 18, icon: "ğŸœ" },
            { name: "ç±³ç²‰", category: "ä¸»é£Ÿ", gi: 58, gl: 15, icon: "ğŸœ" },
            { name: "è›‹åŒ…é¥­", category: "ä¸»é£Ÿ", gi: 70, gl: 20, icon: "ğŸ³" },
            { name: "é¸¡è‚‰", category: "è›‹ç™½è´¨", gi: 0, gl: 0, icon: "ğŸ—" },
            { name: "é±¼è‚‰", category: "è›‹ç™½è´¨", gi: 0, gl: 0, icon: "ğŸŸ" },
            { name: "ç‰›è‚‰", category: "è›‹ç™½è´¨", gi: 0, gl: 0, icon: "ğŸ¥©" },
            { name: "é¸¡è›‹", category: "è›‹ç™½è´¨", gi: 0, gl: 0, icon: "ğŸ¥š" },
            { name: "è±†è…", category: "è›‹ç™½è´¨", gi: 42, gl: 1, icon: "ğŸ§Š" },
            { name: "çº³è±†", category: "è›‹ç™½è´¨", gi: 33, gl: 2, icon: "ğŸ«˜" },
            { name: "è¥¿å…°èŠ±", category: "è”¬èœ", gi: 15, gl: 1, icon: "ğŸ¥¦" },
            { name: "é»„ç“œ", category: "è”¬èœ", gi: 15, gl: 0, icon: "ğŸ¥’" },
            { name: "è¥¿çº¢æŸ¿", category: "è”¬èœ", gi: 30, gl: 1, icon: "ğŸ…" },
            { name: "èŒ„å­", category: "è”¬èœ", gi: 25, gl: 1, icon: "ğŸ†" },
            { name: "è‹¹æœ", category: "æ°´æœ", gi: 36, gl: 5, icon: "ğŸ" },
            { name: "æ©™å­", category: "æ°´æœ", gi: 43, gl: 5, icon: "ğŸŠ" },
            { name: "å¥‡å¼‚æœ", category: "æ°´æœ", gi: 35, gl: 4, icon: "ğŸ¥" },
            { name: "é¥¼å¹²", category: "é›¶é£Ÿ", gi: 77, gl: 14, icon: "ğŸª" },
            { name: "ç‰›å¥¶", category: "é¥®å“", gi: 27, gl: 3, icon: "ğŸ¥›" },
            { name: "è±†æµ†", category: "é¥®å“", gi: 30, gl: 2, icon: "ğŸ¥›" }
        ];
        
        let selectedDateIndex = allData.length - 1;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            renderDateSelector();
            renderDayData(selectedDateIndex);
            renderGIDatabase();
            renderWeekTable();
            initChart();
            setupEventListeners();
        });
        
        function renderDateSelector() {
            const selector = document.getElementById('date-selector');
            selector.innerHTML = allData.map((day, i) => `
                <div class="date-item ${i === selectedDateIndex ? 'active' : ''} ${day.meals.length > 0 ? 'has-data' : ''}" onclick="selectDate(${i})">
                    <div class="date-weekday">${day.weekday}</div>
                    <div class="date-day">${day.date.replace('12æœˆ','').replace('æ—¥','')}</div>
                </div>
            `).join('');
            setTimeout(() => {
                const active = selector.querySelector('.date-item.active');
                if (active) active.scrollIntoView({ behavior: 'smooth', inline: 'center' });
            }, 100);
        }
        
        function selectDate(index) {
            selectedDateIndex = index;
            renderDateSelector();
            renderDayData(index);
        }
        
        function renderDayData(index) {
            const day = allData[index];
            document.getElementById('current-date').textContent = `2025å¹´${day.date} ${day.weekday}`;
            document.getElementById('weight-display').innerHTML = day.weight ? `${day.weight}<span class="unit">kg</span>` : `--<span class="unit">kg</span>`;
            document.getElementById('steps-display').innerHTML = day.steps ? `${day.steps}<span class="unit">æ­¥</span>` : `--<span class="unit">æ­¥</span>`;
            renderMealCards(day);
            renderDailySummary(day);
            renderAdvice(day);
        }
        
        function renderMealCards(day) {
            const container = document.getElementById('meal-cards');
            const mealTypes = { breakfast: { name: 'æ—©é¤', icon: 'ğŸŒ…', class: 'breakfast' }, lunch: { name: 'åˆé¤', icon: 'â˜€ï¸', class: 'lunch' }, dinner: { name: 'æ™šé¤', icon: 'ğŸŒ™', class: 'dinner' } };
            const meals = day.meals.filter(m => m.type !== 'snack');
            if (meals.length === 0) {
                container.innerHTML = `<div style="text-align:center;padding:30px;color:var(--text-light);"><div style="font-size:2.5rem;margin-bottom:10px;">ğŸ“</div><div>ä»Šå¤©è¿˜æ²¡æœ‰è®°å½•</div></div>`;
                return;
            }
            container.innerHTML = meals.map(meal => {
                const info = mealTypes[meal.type] || mealTypes.breakfast;
                const cls = getGlucoseClass(meal.glucose);
                const foodTags = meal.foods.map(f => {
                    const gi = giDatabase.find(g => f.includes(g.name));
                    let giCls = 'low';
                    if (gi && gi.gi > 70) giCls = 'high';
                    else if (gi && gi.gi > 55) giCls = 'medium';
                    return `<span class="food-tag"><span class="gi-dot ${giCls}"></span>${f}</span>`;
                }).join('');
                const avgGI = calculateMealGI(meal.foods);
                const carbs = estimateCarbs(meal.foods);
                return `
                    <div class="meal-card">
                        <div class="meal-header">
                            <div class="meal-info">
                                <div class="meal-icon ${info.class}">${info.icon}</div>
                                <div><div class="meal-name">${info.name}</div><div class="meal-time">${meal.time} è¿›é¤</div></div>
                            </div>
                            <div style="text-align:right;">
                                ${meal.glucose ? `<div class="glucose-value ${cls}">${meal.glucose}</div><div class="glucose-label">é¤åè¡€ç³–</div>` : `<div class="glucose-value" style="color:var(--text-light);">--</div><div class="glucose-label">æœªæµ‹é‡</div>`}
                            </div>
                        </div>
                        <div class="meal-foods"><div class="food-tags">${foodTags}</div></div>
                        <div class="meal-analysis">
                            <div class="analysis-item"><div class="analysis-value" style="color:${avgGI > 60 ? 'var(--warning)' : 'var(--success)'};">${avgGI}</div><div class="analysis-label">GIå‡å€¼</div></div>
                            <div class="analysis-item"><div class="analysis-value">${carbs}g</div><div class="analysis-label">ä¼°ç®—ç¢³æ°´</div></div>
                            <div class="analysis-item"><div class="analysis-value" style="color:${meal.glucose && meal.glucose <= 120 ? 'var(--success)' : 'var(--danger)'};">${meal.glucose ? (meal.glucose <= 120 ? 'âœ“' : 'âœ—') : '-'}</div><div class="analysis-label">è¾¾æ ‡</div></div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function calculateMealGI(foods) {
            let total = 0, count = 0;
            foods.forEach(f => {
                const gi = giDatabase.find(g => f.includes(g.name));
                if (gi && gi.gi > 0) { total += gi.gi; count++; }
            });
            return count > 0 ? Math.round(total / count) : 45;
        }
        
        function estimateCarbs(foods) {
            let carbs = 0;
            foods.forEach(f => {
                if (f.includes('é¥­') || f.includes('ç±³')) carbs += 40;
                else if (f.includes('é¢') || f.includes('é¦’å¤´')) carbs += 35;
                else if (f.includes('é¥ºå­')) carbs += 25;
                else if (f.includes('é¢åŒ…')) carbs += 20;
                else if (f.includes('æ©™') || f.includes('æ©˜') || f.includes('æœ')) carbs += 15;
                else if (f.includes('é¥¼å¹²')) carbs += 15;
            });
            return carbs || 30;
        }
        
        function getGlucoseClass(g) {
            if (!g) return '';
            if (g <= 120) return 'normal';
            if (g <= 130) return 'warning';
            return 'high';
        }
        
        function renderDailySummary(day) {
            const meals = day.meals.filter(m => m.glucose);
            const normal = meals.filter(m => m.glucose <= 120).length;
            const high = meals.filter(m => m.glucose > 120).length;
            document.getElementById('summary-meals').textContent = meals.length;
            document.getElementById('summary-normal').textContent = normal;
            document.getElementById('summary-high').textContent = high;
            const badge = document.getElementById('summary-badge');
            if (high === 0 && meals.length > 0) { badge.textContent = 'ä¼˜ç§€ â­'; badge.style.background = 'rgba(78,205,196,0.3)'; }
            else if (high <= 1) { badge.textContent = 'è‰¯å¥½'; badge.style.background = 'rgba(255,179,71,0.3)'; }
            else { badge.textContent = 'éœ€å…³æ³¨'; badge.style.background = 'rgba(255,107,107,0.3)'; }
        }
        
        function renderAdvice(day) {
            const container = document.getElementById('advice-cards');
            const advices = [];
            const breakfast = day.meals.find(m => m.type === 'breakfast');
            if (breakfast && breakfast.glucose > 120) {
                advices.push({ type: 'warning', icon: 'ğŸ³', title: 'æ—©é¤è¡€ç³–åé«˜', text: 'æ—©é¤ç¢³æ°´å¯èƒ½è¿‡å¤šï¼Œå»ºè®®å‡å°‘é¥ºå­/é¢åŒ…é‡ï¼Œæˆ–æ›¿æ¢ä¸ºä½GIé£Ÿç‰©ã€‚' });
            }
            const dinner = day.meals.find(m => m.type === 'dinner');
            if (dinner && dinner.glucose && dinner.glucose <= 110) {
                advices.push({ type: 'success', icon: 'ğŸŒ™', title: 'æ™šé¤æ§åˆ¶ä¼˜ç§€', text: 'è¡€ç³–æ§åˆ¶åœ¨110ä»¥ä¸‹ï¼Œç»§ç»­ä¿æŒè›‹ç™½è´¨+è”¬èœ+æ‚ç²®çš„æ­é…ï¼' });
            }
            if (day.steps && day.steps < 6000) {
                advices.push({ type: 'danger', icon: 'ğŸš¶', title: 'è¿åŠ¨ä¸è¶³', text: `ä»Šæ—¥${day.steps}æ­¥ï¼Œæœªè¾¾6000æ­¥ç›®æ ‡ã€‚å»ºè®®é¤åæ•£æ­¥15-20åˆ†é’Ÿã€‚` });
            } else if (day.steps && day.steps >= 6000) {
                advices.push({ type: 'success', icon: 'ğŸ‘', title: 'è¿åŠ¨è¾¾æ ‡', text: `ä»Šæ—¥${day.steps}æ­¥ï¼Œå·²è¾¾æ ‡ï¼é¤åè¿åŠ¨å¯¹è¡€ç³–å¸®åŠ©å¾ˆå¤§ã€‚` });
            }
            if (day.notes && day.notes.includes('é»‘ä¾¿')) {
                advices.push({ type: 'info', icon: 'âš ï¸', title: 'å…³æ³¨æ’ä¾¿', text: 'å‡ºç°é»‘è‰²å¤§ä¾¿ï¼Œå¯èƒ½ä¸è¡¥é“å‰‚æœ‰å…³ã€‚å¦‚æŒç»­è¯·å’¨è¯¢åŒ»ç”Ÿã€‚' });
            }
            if (advices.length === 0) {
                advices.push({ type: 'info', icon: 'ğŸ’¡', title: 'è¿›é¤æç¤º', text: 'è®°å¾—ä¿æŒ"å…ˆè”¬èœâ†’è›‹ç™½è´¨â†’ä¸»é£Ÿ"çš„è¿›é¤é¡ºåºã€‚' });
            }
            container.innerHTML = advices.map(a => `
                <div class="advice-card ${a.type}">
                    <div class="advice-icon">${a.icon}</div>
                    <div><div class="advice-title">${a.title}</div><div class="advice-text">${a.text}</div></div>
                </div>
            `).join('');
        }
        
        function renderGIDatabase() {
            const input = document.getElementById('gi-search-input');
            const results = document.getElementById('gi-results');
            const common = document.getElementById('common-foods');
            renderGIResults(common, giDatabase.slice(0, 8));
            input.addEventListener('input', function() {
                const q = this.value.toLowerCase();
                if (q.length === 0) { results.innerHTML = ''; return; }
                const r = giDatabase.filter(f => f.name.toLowerCase().includes(q) || f.category.includes(q));
                renderGIResults(results, r);
            });
        }
        
        function renderGIResults(container, items) {
            if (items.length === 0) { container.innerHTML = '<div style="text-align:center;padding:16px;color:var(--text-light);">æœªæ‰¾åˆ°</div>'; return; }
            container.innerHTML = items.map(f => {
                let cls = 'low';
                if (f.gi > 70) cls = 'high';
                else if (f.gi > 55) cls = 'medium';
                return `
                    <div class="gi-result-item">
                        <div class="gi-food-info">
                            <div class="gi-food-icon ${cls}">${f.icon}</div>
                            <div><div class="gi-food-name">${f.name}</div><div class="gi-food-category">${f.category}</div></div>
                        </div>
                        <div style="text-align:right;"><div class="gi-value ${cls}">GI ${f.gi}</div><div class="gl-value">GL ${f.gl}</div></div>
                    </div>
                `;
            }).join('');
        }
        
        function renderWeekTable() {
            const tbody = document.getElementById('week-table-body');
            tbody.innerHTML = allData.map(d => {
                const b = d.meals.find(m => m.type === 'breakfast');
                const l = d.meals.find(m => m.type === 'lunch');
                const di = d.meals.find(m => m.type === 'dinner');
                const cell = m => m && m.glucose ? `<td class="glucose-cell ${getGlucoseClass(m.glucose)}">${m.glucose}</td>` : '<td>-</td>';
                return `<tr><td>${d.date.replace('12æœˆ','').replace('æ—¥','')}æ—¥</td><td>${d.weight || '-'}</td>${cell(b)}${cell(l)}${cell(di)}<td>${d.steps || '-'}</td></tr>`;
            }).join('');
        }
        
        function initChart() {
            const ctx = document.getElementById('glucose-chart');
            if (!ctx) return;
            const labels = [], data = [], colors = [];
            allData.forEach(d => {
                d.meals.forEach(m => {
                    if (m.glucose) {
                        labels.push(d.date.replace('12æœˆ','').replace('æ—¥','') + (m.type === 'breakfast' ? 'æ—©' : m.type === 'lunch' ? 'åˆ' : 'æ™š'));
                        data.push(m.glucose);
                        colors.push(m.glucose <= 120 ? 'rgba(78,205,196,0.8)' : 'rgba(255,107,107,0.8)');
                    }
                });
            });
            new Chart(ctx, {
                type: 'bar',
                data: { labels, datasets: [{ data, backgroundColor: colors, borderRadius: 4 }] },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { min: 80, max: 150 }, x: { ticks: { font: { size: 8 }, maxRotation: 45 } } }
                }
            });
            calculateMealAverages();
        }
        
        function calculateMealAverages() {
            const b = [], l = [], d = [];
            allData.forEach(day => day.meals.forEach(m => {
                if (m.glucose) {
                    if (m.type === 'breakfast') b.push(m.glucose);
                    else if (m.type === 'lunch') l.push(m.glucose);
                    else if (m.type === 'dinner') d.push(m.glucose);
                }
            }));
            const avg = arr => arr.length ? Math.round(arr.reduce((a, c) => a + c, 0) / arr.length) : 0;
            document.getElementById('breakfast-avg').textContent = avg(b);
            document.getElementById('lunch-avg').textContent = avg(l);
            document.getElementById('dinner-avg').textContent = avg(d);
            const all = [...b, ...l, ...d];
            const normal = all.filter(g => g <= 120).length;
            document.getElementById('compliance-rate').textContent = Math.round((normal / all.length) * 100) + '%';
            document.getElementById('avg-glucose').innerHTML = avg(all) + '<span class="unit">mg/dL</span>';
        }
        
        // ä¿å­˜é¥®é£Ÿè®°å½•
        function saveMealRecord() {
            const selectedType = document.querySelector('.meal-type-btn.active');
            const mealType = selectedType ? selectedType.dataset.type : 'breakfast';
            const foods = document.getElementById('meal-foods-input').value.trim();
            const glucose = document.getElementById('meal-glucose-input').value;
            const time = document.getElementById('meal-time-input').value;

            // éªŒè¯å¿…å¡«é¡¹
            if (!foods) {
                alert('âŒ è¯·å¡«å†™é£Ÿç‰©å†…å®¹');
                return;
            }
            if (!time) {
                alert('âŒ è¯·é€‰æ‹©æµ‹é‡æ—¶é—´');
                return;
            }

            // å¤„ç†é£Ÿç‰©åˆ—è¡¨ï¼ˆæŒ‰é€—å·æˆ–æ¢è¡Œåˆ†éš”ï¼‰
            const foodList = foods.split(/[,ï¼Œ\n]/).map(f => f.trim()).filter(f => f);

            // è·å–å½“å‰æ—¥æœŸ
            const now = new Date();
            const dateStr = `${now.getMonth() + 1}æœˆ${now.getDate()}æ—¥`;
            const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
            const weekday = weekdays[now.getDay()];

            // æŸ¥æ‰¾æˆ–åˆ›å»ºä»Šå¤©çš„è®°å½•
            let todayIndex = allData.findIndex(d => d.date === dateStr);
            if (todayIndex === -1) {
                // åˆ›å»ºä»Šå¤©çš„æ–°è®°å½•
                allData.push({
                    date: dateStr,
                    weekday: weekday,
                    weight: null,
                    fasting: null,
                    steps: null,
                    meals: []
                });
                todayIndex = allData.length - 1;
            }

            // æ·»åŠ é¤é£Ÿè®°å½•
            const newMeal = {
                type: mealType,
                time: time,
                foods: foodList,
                glucose: glucose ? parseInt(glucose) : null
            };

            // æ£€æŸ¥æ˜¯å¦å·²æœ‰ç›¸åŒé¤æ¬¡çš„è®°å½•
            const existingMealIndex = allData[todayIndex].meals.findIndex(m => m.type === mealType);
            if (existingMealIndex >= 0) {
                if (confirm(`âš ï¸ ä»Šå¤©çš„${selectedType.textContent}å·²æœ‰è®°å½•ï¼Œæ˜¯å¦è¦†ç›–ï¼Ÿ`)) {
                    allData[todayIndex].meals[existingMealIndex] = newMeal;
                } else {
                    return;
                }
            } else {
                allData[todayIndex].meals.push(newMeal);
            }

            // ä¿å­˜åˆ° localStorage
            saveData();

            // å…³é—­æ¨¡æ€æ¡†å¹¶åˆ·æ–°é¡µé¢
            hideModal('add-meal-modal');

            // é‡ç½®è¡¨å•
            document.getElementById('meal-foods-input').value = '';
            document.getElementById('meal-glucose-input').value = '';
            document.getElementById('meal-time-input').value = '';

            // é€‰ä¸­ä»Šå¤©çš„æ—¥æœŸå¹¶åˆ·æ–°æ˜¾ç¤º
            selectedDateIndex = todayIndex;
            renderDateSelector();
            renderDayData(todayIndex);
            renderWeekTable();
            initChart();

            alert('âœ… è®°å½•ä¿å­˜æˆåŠŸï¼');
        }

        function setupEventListeners() {
            document.getElementById('photo-input').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const area = document.getElementById('photo-upload-area');
                        area.innerHTML = `<img src="${e.target.result}">`;
                        area.classList.add('has-image');
                        setTimeout(showAnalysisResult, 1500);
                    };
                    reader.readAsDataURL(file);
                }
            });
            document.querySelectorAll('.meal-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.meal-type-btn').forEach(b => { b.style.borderColor = 'var(--border)'; b.style.background = 'white'; });
                    this.style.borderColor = 'var(--primary)';
                    this.style.background = 'var(--primary-light)';
                });
            });
        }
        
        function showAnalysisResult() {
            const foods = [{ name: 'ç±³é¥­', gi: 83 }, { name: 'çº¢çƒ§è‚‰', gi: 0 }, { name: 'é’èœ', gi: 15 }];
            document.getElementById('detected-foods').innerHTML = foods.map(f => {
                let cls = 'low';
                if (f.gi > 70) cls = 'high';
                else if (f.gi > 55) cls = 'medium';
                return `<div class="gi-result-item"><div><div style="font-weight:600;">${f.name}</div></div><div class="gi-value ${cls}">GI ${f.gi}</div></div>`;
            }).join('') + `<div class="tip-box warning" style="margin-top:12px;">ğŸ’¡ <strong>å»ºè®®</strong>ï¼šç±³é¥­GIè¾ƒé«˜ï¼Œå»ºè®®ç”¨ç„ç±³æ›¿ä»£æˆ–å‡å°‘ä»½é‡ã€‚</div>`;
            document.getElementById('analysis-result').classList.add('show');
        }
        
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            const navId = 'nav-' + pageId.replace('page-', '');
            const nav = document.getElementById(navId);
            if (nav) nav.classList.add('active');
            window.scrollTo(0, 0);
        }
        
        function showModal(id) { document.getElementById(id).classList.add('active'); document.body.style.overflow = 'hidden'; }
        function hideModal(id) {
            document.getElementById(id).classList.remove('active');
            document.body.style.overflow = '';
            if (id === 'photo-modal') {
                const area = document.getElementById('photo-upload-area');
                area.innerHTML = `<div class="upload-icon">ğŸ“¸</div><div class="upload-text">ç‚¹å‡»æ‹ç…§æˆ–é€‰æ‹©å›¾ç‰‡</div><div class="upload-hint">AIå°†è‡ªåŠ¨è¯†åˆ«é£Ÿç‰©å¹¶åˆ†æGIå€¼</div>`;
                area.classList.remove('has-image');
                document.getElementById('analysis-result').classList.remove('show');
                document.getElementById('photo-input').value = '';
            }
        }
        
        document.querySelectorAll('.modal-overlay').forEach(m => {
            m.addEventListener('click', function(e) { if (e.target === this) hideModal(this.id); });
        });
    </script>
</body>
</html>