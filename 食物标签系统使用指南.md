# 糖妈日记 - 食物标签系统使用指南 🏷️

## 📋 目录

1. [系统概述](#系统概述)
2. [准备工作](#准备工作)
3. [拍摄指南](#拍摄指南)
4. [批量识别](#批量识别)
5. [应用集成](#应用集成)
6. [成本估算](#成本估算)

---

## 🎯 系统概述

### 工作原理

```
您拍照 → 批量识别 → 生成标签数据库 → 应用调用 → 显示标签
  📷        🤖          💾             📱          🏷️
```

### 优势

- ✅ **一次性成本**：只需识别一次，永久使用
- ✅ **离线可用**：本地数据库，无需网络
- ✅ **速度快**：直接查询JSON，毫秒级响应
- ✅ **可扩展**：随时添加新食物
- ✅ **个性化**：针对在日中国宝妈常吃的食物

---

## 🛠️ 准备工作

### 第一步：创建照片目录

```bash
cd ~/Desktop/GitHub-Projects/websites/tangma-diary
mkdir food-photos
```

### 第二步：安装依赖

```bash
# 安装Anthropic Python SDK
pip3 install anthropic

# 或使用国内源加速
pip3 install anthropic -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 第三步：设置API密钥

```bash
# 设置环境变量
export ANTHROPIC_API_KEY='your-api-key-here'

# 验证设置
echo $ANTHROPIC_API_KEY
```

**获取API密钥**：
1. 访问：https://console.anthropic.com/
2. 登录账号
3. 进入API Keys页面
4. 创建新密钥

---

## 📷 拍摄指南

### 拍摄清单（建议先拍这些）

#### 主食类 🍚 （15-20种）
- [ ] 白米饭
- [ ] 玄米饭（糙米饭）
- [ ] 杂粮饭
- [ ] 白面包
- [ ] 全麦面包
- [ ] 乌冬面
- [ ] 荞麦面
- [ ] 拉面
- [ ] 饺子
- [ ] 包子
- [ ] 馒头
- [ ] 寿司
- [ ] 粥
- [ ] 意大利面
- [ ] 米粉

#### 蛋白质类 🥩 （15-20种）
- [ ] 鸡蛋
- [ ] 鸡胸肉
- [ ] 鸡腿肉
- [ ] 牛肉
- [ ] 猪肉
- [ ] 鱼（鲑鱼、鲭鱼、秋刀鱼等）
- [ ] 豆腐
- [ ] 纳豆
- [ ] 味增
- [ ] 牛奶
- [ ] 酸奶
- [ ] 芝士
- [ ] 虾
- [ ] 蟹
- [ ] 贝类

#### 蔬菜类 🥬 （20-30种）
- [ ] 西兰花
- [ ] 菠菜
- [ ] 小松菜
- [ ] 白菜
- [ ] 胡萝卜
- [ ] 南瓜
- [ ] 番茄
- [ ] 黄瓜
- [ ] 茄子
- [ ] 青椒
- [ ] 洋葱
- [ ] 大蒜
- [ ] 生姜
- [ ] 白萝卜
- [ ] 芦笋
- [ ] 蘑菇
- [ ] 海带
- [ ] 裙带菜
- [ ] 豆芽
- [ ] 豆角

#### 水果类 🍎 （10-15种）
- [ ] 苹果
- [ ] 香蕉
- [ ] 柚子
- [ ] 橙子
- [ ] 草莓
- [ ] 蓝莓
- [ ] 奇异果
- [ ] 葡萄
- [ ] 梨
- [ ] 桃子
- [ ] 樱桃
- [ ] 西瓜
- [ ] 哈密瓜
- [ ] 柿子
- [ ] 火龙果

#### 坚果类 🥜 （5-10种）
- [ ] 核桃
- [ ] 杏仁
- [ ] 腰果
- [ ] 花生
- [ ] 松子
- [ ] 夏威夷果
- [ ] 芝麻
- [ ] 瓜子

### 拍摄技巧

1. **光线充足**：
   - 自然光最佳
   - 避免阴影
   - 不要逆光

2. **角度合适**：
   - 45度俯拍
   - 食物占画面60-80%
   - 背景简洁

3. **清晰度**：
   - 对焦准确
   - 不要模糊
   - 分辨率>800x800

4. **文件命名**：
   ```
   xuanmi-fan.jpg  (玄米饭)
   jidan.jpg       (鸡蛋)
   xilanhua.jpg    (西兰花)
   ```
   建议使用拼音命名，方便识别

5. **每种食物拍1-2张**：
   - 主图：整体照片
   - （可选）细节照：特写

---

## 🤖 批量识别

### 运行识别脚本

```bash
# 确保在项目目录
cd ~/Desktop/GitHub-Projects/websites/tangma-diary

# 给脚本执行权限
chmod +x batch-food-recognition.py

# 运行识别
python3 batch-food-recognition.py
```

### 识别过程

```
============================================================
🍽️  糖妈日记 - 批量食物识别
============================================================

📷 找到 50 张照片
------------------------------------------------------------

[1/50] 🔍 正在识别：food-photos/xuanmi-fan.jpg
✅ 识别成功：玄米饭

[2/50] 🔍 正在识别：food-photos/jidan.jpg
✅ 识别成功：鸡蛋

[3/50] 🔍 正在识别：food-photos/xilanhua.jpg
✅ 识别成功：西兰花

... (省略)

============================================================
✅ 识别完成！成功识别 50/50 种食物
============================================================

💾 数据库已保存到：./food-tags-database.json
📊 数据库统计：
   - 总食物数：50
   - 主食：15
   - 蛋白质：18
   - 蔬菜：12
   - 水果：3
   - 坚果：2

✨ 完成！现在可以在应用中使用这个标签数据库了。
```

### 识别结果示例

生成的 `food-tags-database.json` 文件结构：

```json
{
  "version": "1.0",
  "totalFoods": 50,
  "foods": [
    {
      "id": "food_001",
      "name": {
        "zh": "玄米饭",
        "ja": "玄米ご飯",
        "en": "Brown Rice"
      },
      "category": "主食",
      "categoryIcon": "🍚",
      "nutrition": {
        "carbs": 34,
        "protein": 3,
        "gi": 55
      },
      "tags": [
        {"type": "category", "label": "主食", "icon": "🍚"},
        {"type": "gi", "label": "中GI", "icon": "⚠️"},
        {"type": "carb", "label": "中碳水", "icon": "⚠️"}
      ],
      "recommendation": {
        "level": "推荐",
        "emoji": "✅",
        "reason": "比白米饭GI值低，富含膳食纤维"
      }
    }
  ]
}
```

---

## 💻 应用集成

### 将数据库集成到应用

识别完成后，我会：

1. **添加标签显示UI**
2. **实现标签搜索和筛选**
3. **在食物输入时显示标签**
4. **在历史记录中显示标签**

### 预览效果

#### 添加记录时：
```
┌─────────────────────────────┐
│ 🍽️ 食物：玄米饭            │
│                             │
│ 🏷️ 标签：                  │
│ [🍚 主食] [⚠️ 中GI]        │
│ [⚠️ 中碳水]                │
│                             │
│ 📊 营养：碳水34g/100g       │
│ 💡 建议：适量食用          │
└─────────────────────────────┘
```

#### 历史记录显示：
```
┌─────────────────────────────┐
│ 🍽️ 早餐 - 08:00            │
├─────────────────────────────┤
│ 🍚 玄米饭 #主食 #中GI      │
│ 🥚 鸡蛋 #蛋白质 #低GI      │
│ 🥬 西兰花 #蔬菜 #低GI      │
│                             │
│ 🩸 血糖：112 mg/dL ✅       │
│ 💡 碳水：约42g              │
└─────────────────────────────┘
```

---

## 💰 成本估算

### Claude Vision API定价

- **模型**：claude-3-5-sonnet-20241022
- **Input**：$3/MTok
- **Output**：$15/MTok

### 单张识别成本

```
Input tokens:  ~1800 (图片1600 + 提示词200)
Output tokens: ~300  (JSON响应)

成本 = (1800/1000000 × $3) + (300/1000000 × $15)
    = $0.0054 + $0.0045
    = $0.0099 ≈ $0.01/张
```

### 批量识别成本

| 食物数量 | 成本估算 | 备注 |
|---------|---------|------|
| 50种 | $0.50 | 基础食物库 |
| 100种 | $1.00 | 完整食物库 |
| 200种 | $2.00 | 扩展食物库 |

**结论**：建立一个包含100种常吃食物的数据库，**只需$1**！

### 后续成本

- ✅ **查询数据库**：完全免费
- ✅ **离线使用**：完全免费
- ⏳ **添加新食物**：$0.01/张

---

## 📝 下一步计划

### Phase 1（您做）：拍摄食物照片
- 参考上面的拍摄清单
- 建议先拍50-100种常吃的
- 放到 `food-photos/` 目录

### Phase 2（我做）：运行识别脚本
- 检查照片质量
- 运行批量识别
- 生成标签数据库
- 验证识别结果

### Phase 3（我做）：应用集成
- 添加标签显示UI
- 实现标签搜索
- 集成到添加记录流程
- 在历史记录中显示标签

### Phase 4（测试）：用户测试
- 测试标签显示
- 测试搜索功能
- 收集反馈
- 优化体验

---

## 🆘 常见问题

### Q1: 识别准确吗？
**A**: Claude Vision准确率很高（95%+），但建议：
- 每种食物的识别结果都会显示
- 可以手动修正不准确的数据
- 营养数据基于权威数据库

### Q2: 可以识别混合食物吗？
**A**: 可以！比如：
- 炒饭 → 识别出米饭、鸡蛋、蔬菜
- 沙拉 → 识别出各种蔬菜
- 汤 → 识别出主要食材

### Q3: 如何添加新食物？
**A**: 很简单：
1. 拍新照片放到 `food-photos/`
2. 重新运行识别脚本
3. 会自动合并到现有数据库

### Q4: 可以手动编辑数据库吗？
**A**: 可以！`food-tags-database.json` 是标准JSON，可以：
- 手动修正营养数据
- 添加别名
- 修改推荐等级
- 添加自定义标签

### Q5: 成本会不会很高？
**A**: 不会！
- 一次性识别成本：$1-2
- 后续使用完全免费
- 比买一杯咖啡还便宜 ☕

---

## ✨ 总结

这个系统的优势：

1. **低成本**：一次性$1-2，永久使用
2. **高效率**：拍照 → 识别 → 数据库 → 使用
3. **个性化**：针对在日中国宝妈的常吃食物
4. **可扩展**：随时添加新食物
5. **完全离线**：数据库在本地，无需网络

**现在请您准备拍照，我们开始建立专属的食物标签数据库吧！** 📷✨
